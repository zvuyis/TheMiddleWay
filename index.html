<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#000000">
    <script src="https://cdn.jsdelivr.net/npm/@vladmandic/face-api/dist/face-api.js"></script>
    <style>
        body{margin:0;background:#000;overflow:hidden;font-family:sans-serif;display:flex;justify-content:center;align-items:center;height:100vh}
        canvas{position:absolute;left:0;top:0;width:100vw;height:100vh;object-fit:cover;display:none}
        video{display:none}
        #landing{position:relative;z-index:200;text-align:center;color:#fff;padding:20px;max-width:400px}
        #app-logo{width:180px;height:180px;margin-bottom:20px;border-radius:50%;border:2px solid #0f0;box-shadow: 0 0 20px rgba(15, 255, 0, 0.4); background: #fff; object-fit: contain;}
        #landing h1{font-size:38px;margin:0 0 10px 0;color:#0f0;text-shadow:0 0 10px rgba(0,255,0,0.5)}
        #landing p{font-size:18px;margin-bottom:30px;line-height:1.6;opacity:0.9}
        #startBtn{padding:18px 50px;font-size:22px;border-radius:40px;border:none;background:#0f0;color:#000;font-weight:700;cursor:pointer;box-shadow:0 0 25px rgba(0,255,0,0.4);transition:transform 0.2s}
        #startBtn:active{transform:scale(0.95)}
        #privacy-note{margin-top:20px;font-size:12px;color:#888}
        #instruction{position:absolute;top:25px;width:90%;text-align:center;color:#fff;font-size:16px;font-weight:700;text-shadow:2px 2px 4px #000;z-index:100;display:none;pointer-events:none;line-height:1.4;background:rgba(0,0,0,0.5);padding:12px;border-radius:15px}
        #instruction span{font-size:13px;font-weight:400;opacity:0.95}
        #ui{position:absolute;bottom:40px;width:100%;display:none;flex-wrap:wrap;justify-content:center;gap:12px;z-index:100;padding:10px;box-sizing:border-box}
        button.tool-btn{padding:12px 18px;border-radius:25px;border:2px solid #0f0;background:rgba(0,0,0,0.8);color:#0f0;font-weight:700;min-width:80px}
        button.active{background:#0f0;color:#000}
        #recBtn.recording{border-color:#ff4444;color:#ff4444;animation:blink 1s infinite}@keyframes blink{50%{opacity:.5}}
    </style>
</head>
<body>
    <div id="landing">
        <img src="logo.png" id="app-logo" alt="SymmetryFace Logo">
        <h1>SymmetryFace</h1>
        <p>×’×œ×• ××ª ×”×¡×™××˜×¨×™×” ×”××•×©×œ××ª ×©×œ ×”×¤× ×™× ×©×œ×›×.<br>×”×¢×™×‘×•×“ ××ª×‘×¦×¢ ×‘××›×©×™×¨×›× ×‘×œ×‘×“.</p>
        <button id="startBtn" onclick="_0xSTART()">×”×ª×—×œ×ª ×—×•×•×™×”</button>
        <div id="privacy-note">×”××¦×œ××” ×ª×™×¤×ª×— ×¨×§ ×œ××—×¨ ×”××™×©×•×¨. ×”××™×“×¢ ××™× ×• × ×©××¨ ×‘×©×¨×ª.</div>
    </div>

    <div id="instruction">
        ×©××•×¨ ×¢×œ ×”×¨××© ×™×©×¨ ××•×œ ×”××¦×œ××”<br>
        <span>×’×¢ ×‘×¤× ×™×™×š ×‘×¢×–×¨×ª ×©×ª×™ ×”×™×“×™×™× ×‘× ×§×•×“×•×ª ×©×•× ×•×ª</span><br>
        <span>×œ×—×¥ ×¢×œ "×¡×¨×˜×•×Ÿ" ××• ×¢×œ "×ª××•× ×”" ×›×“×™ ×œ×©××•×¨ ××œ ××›×©×™×¨×š</span>
    </div>

    <video id="video" playsinline autoplay muted></video>
    <canvas id="canvas"></canvas>
    
    <div id="ui">
        <button onclick="_0xMODE('none')" id="btnNone" class="tool-btn active">×¨×’×™×œ</button>
        <button onclick="_0xMODE('left')" id="btnLeft" class="tool-btn">×©×××œ</button>
        <button onclick="_0xMODE('right')" id="btnRight" class="tool-btn">×™××™×Ÿ</button>
        <button onclick="_0xSNAP()" class="tool-btn" style="border-color:#fff;color:#fff">ğŸ“¸ ×ª××•× ×”</button>
        <button onclick="_0xREC()" id="recBtn" class="tool-btn" style="border-color:#ff4444;color:#ff4444">âº ×¡×¨×˜×•×Ÿ</button>
    </div>

    <script>
        const _0v = document.getElementById('video'), _0c = document.getElementById('canvas'), _0x = _0c.getContext('2d');
        let _0m = 'none', _0r, _0chunks = [], _0isRec = !1, _0smoothX = 0;

        async function _0xSTART() {
            document.getElementById('landing').style.display = 'none';
            _0c.style.display = 'block';
            document.getElementById('ui').style.display = 'flex';
            document.getElementById('instruction').style.display = 'block';
            await _0init();
        }

        async function _0init() {
            await faceapi.nets.tinyFaceDetector.loadFromUri('https://cdn.jsdelivr.net/npm/@vladmandic/face-api/model/');
            await faceapi.nets.faceLandmark68Net.loadFromUri('https://cdn.jsdelivr.net/npm/@vladmandic/face-api/model/');
            const s = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'user' } });
            _0v.srcObject = s;
            _0v.onloadedmetadata = () => {
                _0c.width = _0v.videoWidth;
                _0c.height = _0v.videoHeight;
                _0smoothX = _0c.width / 2;
                _0loop();
            };
        }

        function _0xMODE(m) {
            _0m = m;
            document.querySelectorAll('.tool-btn').forEach(b => b.classList.remove('active'));
            const target = document.getElementById('btn' + m.charAt(0).toUpperCase() + m.slice(1));
            if(target) target.classList.add('active');
        }

        async function _0loop() {
            setInterval(async () => {
                const d = await faceapi.detectAllFaces(_0v, new faceapi.TinyFaceDetectorOptions()).withFaceLandmarks();
                _0x.clearRect(0, 0, _0c.width, _0c.height);
                const w = _0v.videoWidth, h = _0v.videoHeight;

                if (d.length > 0) {
                    const tx = d[0].landmarks.getNose()[0].x;
                    _0smoothX += (tx - _0smoothX) * 0.15;

                    if (_0m === 'none') {
                        _0x.drawImage(_0v, 0, 0, _0c.width, _0c.height);
                    } else if (_0m === 'left') {
                        _0x.drawImage(_0v, 0, 0, _0smoothX, h, 0, 0, _0smoothX, h);
                        _0x.save(); _0x.translate(_0smoothX * 2, 0); _0x.scale(-1, 1);
                        _0x.drawImage(_0v, 0, 0, _0smoothX, h, 0, 0, _0smoothX, h); _0x.restore();
                    } else if (_0m === 'right') {
                        const rw = w - _0smoothX;
                        _0x.drawImage(_0v, _0smoothX, 0, rw, h, _0smoothX, 0, rw, h);
                        _0x.save(); _0x.translate(_0smoothX * 2, 0); _0x.scale(-1, 1);
                        _0x.drawImage(_0v, _0smoothX, 0, rw, h, _0smoothX, 0, rw, h); _0x.restore();
                    }
                } else {
                    _0x.drawImage(_0v, 0, 0, _0c.width, _0c.height);
                }
            }, 40);
        }

        function _0xSNAP() {
            const l = document.createElement('a');
            l.download = 'symmetry-face.png';
            l.href = _0c.toDataURL('image/png');
            l.click();
        }

        function _0xREC() {
            const b = document.getElementById('recBtn');
            if (!_0isRec) {
                _0chunks = [];
                const s = _0c.captureStream(30);
                _0r = new MediaRecorder(s, { mimeType: 'video/webm' });
                _0r.ondataavailable = e => { if (e.data.size > 0) _0chunks.push(e.data); };
                _0r.onstop = () => {
                    const bl = new Blob(_0chunks, { type: 'video/webm' });
                    const u = URL.createObjectURL(bl);
                    const a = document.createElement('a');
                    a.href = u; a.download = 'symmetry-face.webm'; a.click();
                };
                _0r.start();
                b.classList.add('recording'); b.innerText = 'â¹ ×¢×¦×•×¨';
                _0isRec = !0;
            } else {
                _0r.stop();
                b.classList.remove('recording'); b.innerText = 'âº ×¡×¨×˜×•×Ÿ';
                _0isRec = !1;
            }
        }
    </script>
</body>
</html>
